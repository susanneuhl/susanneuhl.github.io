<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Dates – Susanne Uhl</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Entferne weißen Hintergrund */
        body {
            background-color: #efefef !important;
        }
        
        /* Events-Container */
        #event-calendar {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: transparent;
        }
        
        main {
            background: transparent !important;
        }

        #event-calendar h2 {
            text-align: center;
            color: rgb(179, 118, 118);
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 400;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
            background: transparent;
        }

        .event-card {
            position: relative;
            overflow: hidden;
            border-radius: 0;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: none;
        }

        .event-card:hover {
            transform: scale(1.02);
        }

        .event-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 0;
        }

        .event-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(transparent 40%, rgba(0, 0, 0, 0.8));
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            opacity: 1;
        }

        .event-title {
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-location {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        /* Styling für Event-Termine */
        .event-dates {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(179, 118, 118, 0.7) transparent;
        }

        .event-dates::-webkit-scrollbar {
            width: 6px;
        }

        .event-dates::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .event-dates::-webkit-scrollbar-thumb {
            background: rgba(179, 118, 118, 0.7);
            border-radius: 3px;
        }

        .event-dates::-webkit-scrollbar-thumb:hover {
            background: rgba(179, 118, 118, 0.9);
        }
        
                .event-date {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 6px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }

        .event-date:last-child {
            margin-bottom: 0;
        }

        .date-info {
            display: flex;
            flex-direction: column;
        }

        .date-day {
            font-weight: bold;
            color: white;
            font-size: 0.9em;
        }

        .date-time {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
        }

        .date-ticket-link {
            padding: 6px 12px;
            background-color: rgba(179, 118, 118, 0.9);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.8em;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .date-ticket-link:hover {
            background-color: rgb(179, 118, 118);
            transform: translateY(-1px);
        }
        
        .no-events {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .last-updated {
            text-align: center;
            color: #888;
            font-size: 0.9em;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <!-- Sticky Header -->
    <header class="sticky-header">
        <div class="header-content">
            <h1 class="main-title">
                Susanne Uhl
                <span class="subtitle">Kostümbild</span>
            </h1>
        </div>
        <nav class="header-nav">
            <a href="index.html" class="header-nav-link">Work</a>
            <a href="about.html" class="header-nav-link">About</a>
            <a href="shows.html" class="header-nav-link">Dates</a>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <section id="event-calendar">
            <h2>Dates</h2>
            <div class="events-grid" id="shows-container">
                <!-- Shows werden dynamisch geladen -->
            </div>
            <div class="last-updated" id="last-updated"></div>
        </section>
    </main>
    
    <script>
        // Lade Show-Daten und erstelle Events
        async function loadShows() {
            try {
                const response = await fetch('data/shows.json');
                const data = await response.json();
                
                const container = document.getElementById('shows-container');
                const lastUpdatedElement = document.getElementById('last-updated');
                
                // Zeige letztes Update
                const updateDate = new Date(data.last_updated).toLocaleString('de-DE');
                lastUpdatedElement.textContent = `Zuletzt aktualisiert: ${updateDate}`;
                
                // Sortiere Shows nach dem nächsten Termin (chronologisch)
                const sortedShows = Object.entries(data.shows).sort(([aId, aShow], [bId, bShow]) => {
                    // Finde den nächsten zukünftigen Termin für jede Show
                    const now = new Date();
                    
                    const aNextEvent = aShow.events.find(event => new Date(event.date) > now);
                    const bNextEvent = bShow.events.find(event => new Date(event.date) > now);
                    
                    // Falls eine Show keine zukünftigen Termine hat, setze sie ans Ende
                    if (!aNextEvent && !bNextEvent) return 0;
                    if (!aNextEvent) return 1;
                    if (!bNextEvent) return -1;
                    
                    // Sortiere nach dem nächsten Termin
                    return new Date(aNextEvent.date) - new Date(bNextEvent.date);
                });
                
                // Erstelle Events für jede Show (jetzt chronologisch sortiert)
                for (let idx = 0; idx < sortedShows.length; idx++) {
                    const [showId, show] = sortedShows[idx];
                    const eventCard = document.createElement('div');
                    eventCard.className = 'event-card';
                    
                    // Event-Bild (Thumbnail im Grid, AVIF wenn verfügbar)
                    const eventPicture = document.createElement('picture');
                    const eventSource = document.createElement('source');
                    eventSource.type = 'image/avif';

                    // Ableitung des Basenamens aus der Bild-URL (z.B. images/undine.jpg -> undine)
                    const filename = (show.image || '').split('/').pop() || '';
                    const base = filename.replace(/\.(jpg|jpeg|png)$/i, '');

                    // Thumbs sind deutlich kleiner/schneller zu decodieren (gleiches Layout)
                    const thumbAvif = `images/thumbs/${base}.avif`;
                    const thumbJpg = `images/thumbs/${base}.jpg`;

                    eventSource.srcset = thumbAvif;
                    const eventImage = document.createElement('img');
                    eventImage.src = thumbJpg;
                    eventImage.alt = show.title;
                    eventImage.loading = idx < 2 ? 'eager' : 'lazy';
                    eventImage.decoding = 'async';
                    eventImage.fetchPriority = idx < 2 ? 'high' : 'low';

                    // Fallback: falls ein Thumb fehlt, nimm das Original aus shows.json
                    eventImage.onerror = () => {
                        eventImage.onerror = null;
                        eventImage.src = show.image;
                    };
                    
                    eventPicture.appendChild(eventSource);
                    eventPicture.appendChild(eventImage);
                    
                    // Event-Overlay
                    const eventOverlay = document.createElement('div');
                    eventOverlay.className = 'event-overlay';
                    
                    // Titel und Theater
                    const eventTitle = document.createElement('div');
                    eventTitle.className = 'event-title';
                    eventTitle.textContent = show.title;
                    
                    const eventLocation = document.createElement('div');
                    eventLocation.className = 'event-location';
                    eventLocation.textContent = show.theater;
                    
                    eventOverlay.appendChild(eventTitle);
                    eventOverlay.appendChild(eventLocation);
                    
                    // Termine
                    if (show.events && show.events.length > 0) {
                        const eventDates = document.createElement('div');
                        eventDates.className = 'event-dates';
                        
                        show.events.forEach(event => {
                            const dateItem = document.createElement('div');
                            dateItem.className = 'event-date';
                            
                            const dateInfo = document.createElement('div');
                            dateInfo.className = 'date-info';
                            
                            const dateDay = document.createElement('div');
                            dateDay.className = 'date-day';
                            dateDay.textContent = event.display_date;
                            
                            const dateTime = document.createElement('div');
                            dateTime.className = 'date-time';
                            dateTime.textContent = `${event.display_time} Uhr`;
                            
                            dateInfo.appendChild(dateDay);
                            dateInfo.appendChild(dateTime);
                            
                            const ticketLink = document.createElement('a');
                            ticketLink.href = event.ticket_url;
                            ticketLink.target = '_blank';
                            ticketLink.className = 'date-ticket-link';
                            ticketLink.textContent = 'Tickets';
                            
                            dateItem.appendChild(dateInfo);
                            dateItem.appendChild(ticketLink);
                            eventDates.appendChild(dateItem);
                        });
                        
                        eventOverlay.appendChild(eventDates);
                    } else {
                        // Fallback wenn keine Termine verfügbar
                        const noEvents = document.createElement('div');
                        noEvents.className = 'no-events';
                        noEvents.textContent = 'Keine aktuellen Termine verfügbar';
                        eventOverlay.appendChild(noEvents);
                    }
                    
                    eventCard.appendChild(eventPicture);
                    eventCard.appendChild(eventOverlay);
                    container.appendChild(eventCard);
                }
                
            } catch (error) {
                console.error('Fehler beim Laden der Show-Daten:', error);
                document.getElementById('shows-container').innerHTML = 
                    '<div class="no-events">Termine konnten nicht geladen werden. Bitte versuchen Sie es später erneut.</div>';
            }
        }
        
        // Lade Shows beim Seitenaufruf
        document.addEventListener('DOMContentLoaded', loadShows);
    </script>

    <!-- Footer -->
    <footer>
        <p style="text-align: center; margin-top: 20px;">
            © 2025 Susanne Uhl. Alle Rechte vorbehalten. 
            <a href="impressum.html" style="color: #333333; text-decoration: none; margin-left: 10px;">Impressum</a>
        </p>
    </footer>
</body>
</html>
