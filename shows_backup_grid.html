<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts: Hanken Grotesk -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
            <title>Dates – Susanne Uhl</title>
    <link rel="stylesheet" href="styles.css?v=bold6">
    <link rel="icon" href="favicon_custom.png" type="image/png">
    <link rel="shortcut icon" href="favicon_custom.png" type="image/png">
<script>document.documentElement.classList.add('js');</script>
</head>
<body class="page-dates">
    <!-- Sticky Header -->
    <header class="sticky-header">
        <div class="header-content">
            <h1 class="main-title">
                Susanne Uhl
                <span class="subtitle">Kostümbild</span>
            </h1>
        </div>
        <nav class="header-nav">
            <button class="hamburger" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a href="index.html" class="header-nav-link">Work</a>
                <a href="about.html" class="header-nav-link">About</a>
                <a href="shows.html" class="header-nav-link active">Dates</a>
                <a href="contact.html" class="header-nav-link">Contact</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <section id="event-calendar">
            <h2 class="desktop-dates-title">Dates</h2>
            <h2 class="mobile-dates-title">Dates</h2>
            <div class="events-grid" id="shows-container">
                <!-- Shows werden dynamisch geladen -->
            </div>
            <div class="last-updated" id="last-updated"></div>
        </section>
    </main>
    
    <script>
        // Lade Show-Daten und erstelle Events
        async function loadShows() {
            try {
                const response = await fetch('data/shows.json');
                const data = await response.json();
                
                const container = document.getElementById('shows-container');
                const lastUpdatedElement = document.getElementById('last-updated');
                
                // Zeige letztes Update
                const updateDate = new Date(data.last_updated).toLocaleString('de-DE');
                lastUpdatedElement.textContent = `Zuletzt aktualisiert: ${updateDate}`;
                
                // Sortiere Shows nach dem nächsten Termin (chronologisch)
                const sortedShows = Object.entries(data.shows).sort(([aId, aShow], [bId, bShow]) => {
                    // Finde den nächsten zukünftigen Termin für jede Show
                    const now = new Date();
                    
                    const aNextEvent = aShow.events.find(event => new Date(event.date) > now);
                    const bNextEvent = bShow.events.find(event => new Date(event.date) > now);
                    
                    // Falls eine Show keine zukünftigen Termine hat, setze sie ans Ende
                    if (!aNextEvent && !bNextEvent) return 0;
                    if (!aNextEvent) return 1;
                    if (!bNextEvent) return -1;
                    
                    // Sortiere nach dem nächsten Termin
                    return new Date(aNextEvent.date) - new Date(bNextEvent.date);
                });
                
                // Erstelle Events für jede Show (jetzt chronologisch sortiert)
                for (let idx = 0; idx < sortedShows.length; idx++) {
                    const [showId, show] = sortedShows[idx];
                    const eventCard = document.createElement('div');
                    eventCard.className = 'event-card';
                    
                    // Event-Bild (Thumbnail im Grid, AVIF wenn verfügbar)
                    const eventPicture = document.createElement('picture');
                    const eventSource = document.createElement('source');
                    eventSource.type = 'image/avif';

                    // Ableitung des Basenamens aus der Bild-URL (z.B. images/undine.jpg -> undine)
                    const filename = (show.image || '').split('/').pop() || '';
                    const base = filename.replace(/\.(jpg|jpeg|png)$/i, '');

                    // Thumbs sind deutlich kleiner/schneller zu decodieren (gleiches Layout)
                    const thumbAvif = `images/thumbs/${base}.avif`;
                    const thumbJpg = `images/thumbs/${base}.jpg`;

                    eventSource.srcset = thumbAvif;
                    const eventImage = document.createElement('img');
                    eventImage.src = thumbJpg;
                    eventImage.alt = show.title;
                    eventImage.loading = idx < 2 ? 'eager' : 'lazy';
                    eventImage.decoding = 'async';
                    eventImage.fetchPriority = idx < 2 ? 'high' : 'low';

                    // Fallback: falls ein Thumb fehlt, nimm das Original aus shows.json
                    eventImage.onerror = () => {
                        eventImage.onerror = null;
                        eventImage.src = show.image;
                    };
                    
                    eventPicture.appendChild(eventSource);
                    eventPicture.appendChild(eventImage);
                    
                    // Event-Overlay
                    const eventOverlay = document.createElement('div');
                    eventOverlay.className = 'event-overlay';
                    
                    // Titel und Theater
                    const eventTitle = document.createElement('div');
                    eventTitle.className = 'event-title';
                    eventTitle.textContent = show.title;
                    
                    const eventLocation = document.createElement('div');
                    eventLocation.className = 'event-location';
                    eventLocation.textContent = show.theater;
                    
                    eventOverlay.appendChild(eventTitle);
                    eventOverlay.appendChild(eventLocation);
                    
                    // Termine
                    if (show.events && show.events.length > 0) {
                        const eventDates = document.createElement('div');
                        eventDates.className = 'event-dates';
                        
                        show.events.forEach(event => {
                            const dateItem = document.createElement('div');
                            dateItem.className = 'event-date';
                            
                            const dateInfo = document.createElement('div');
                            dateInfo.className = 'date-info';
                            
                            const dateDay = document.createElement('div');
                            dateDay.className = 'date-day';
                            dateDay.textContent = event.display_date;
                            
                            const dateTime = document.createElement('div');
                            dateTime.className = 'date-time';
                            dateTime.textContent = `${event.display_time} Uhr`;
                            
                            dateInfo.appendChild(dateDay);
                            dateInfo.appendChild(dateTime);
                            
                            const ticketLink = document.createElement('a');
                            ticketLink.href = event.ticket_url;
                            ticketLink.target = '_blank';
                            ticketLink.className = 'date-ticket-link';
                            ticketLink.textContent = 'Tickets';
                            
                            dateItem.appendChild(dateInfo);
                            dateItem.appendChild(ticketLink);
                            eventDates.appendChild(dateItem);
                        });
                        
                        eventOverlay.appendChild(eventDates);
                    } else {
                        // Fallback wenn keine Termine verfügbar
                        const noEvents = document.createElement('div');
                        noEvents.className = 'no-events';
                        noEvents.textContent = 'Keine aktuellen Termine verfügbar';
                        eventOverlay.appendChild(noEvents);
                    }
                    
                    eventCard.appendChild(eventPicture);
                    eventCard.appendChild(eventOverlay);
                    container.appendChild(eventCard);
                }
                
                // JSON-LD Event-Schema für SEO erstellen
                const now = new Date();
                const upcomingEvents = [];
                
                // Sammle alle zukünftigen Events aus allen Shows
                for (const [showId, show] of Object.entries(data.shows)) {
                    for (const event of show.events) {
                        if (new Date(event.date) > now) {
                            upcomingEvents.push({
                                title: show.title,
                                date: event.date,
                                time: event.time,
                                location: event.location,
                                theater: show.theater,
                                website: show.website
                            });
                        }
                    }
                }
                
                // Erstelle JSON-LD Schema
                if (upcomingEvents.length > 0) {
                    const eventsSchema = {
                        "@context": "https://schema.org",
                        "@type": "ItemList",
                        "itemListElement": upcomingEvents.map((event, index) => ({
                            "@type": "Event",
                            "name": event.title,
                            "startDate": event.date + (event.time ? 'T' + event.time : ''),
                            "location": {
                                "@type": "Place",
                                "name": event.location,
                                "address": {
                                    "@type": "PostalAddress",
                                    "addressLocality": event.location
                                }
                            },
                            "organizer": {
                                "@type": "Organization",
                                "name": event.theater,
                                "url": event.website
                            },
                            "performer": {
                                "@type": "Person",
                                "name": "Susanne Uhl",
                                "jobTitle": "Kostümbildnerin",
                                "url": "https://susanneuhl.com"
                            },
                            "position": index + 1
                        }))
                    };
                    
                    // Schema in die Seite einfügen
                    const script = document.createElement('script');
                    script.type = 'application/ld+json';
                    script.textContent = JSON.stringify(eventsSchema);
                    document.head.appendChild(script);
                }

            } catch (error) {
                console.error('Fehler beim Laden der Show-Daten:', error);
                document.getElementById('shows-container').innerHTML = 
                    '<div class="no-events">Termine konnten nicht geladen werden. Bitte versuchen Sie es später erneut.</div>';
            }
        }
        
        // Lade Shows beim Seitenaufruf
        document.addEventListener('DOMContentLoaded', loadShows);
    </script>

    <!-- Footer -->
    <footer>
        <p style="text-align: center; margin-top: 20px;">
            © 2026 Susanne Uhl. Alle Rechte vorbehalten. 
            <a href="impressum.html" style="color: #333333; text-decoration: none; margin-left: 10px;">Impressum</a>
        </p>
    </footer>

<script>
(function() {
  // Fade-in on load
  function markLoaded() {
    document.body.classList.add('is-loaded');
    document.body.classList.remove('is-exiting');
  }

  // Ensure correct state when coming from bfcache
  window.addEventListener('pageshow', markLoaded);
  document.addEventListener('DOMContentLoaded', markLoaded);

  // Intercept internal navigation to fade out
  document.addEventListener('click', function(e) {
    const a = e.target.closest && e.target.closest('a');
    if (!a) return;

    // Ignore modified clicks / new tab
    if (e.defaultPrevented) return;
    if (e.button !== 0) return;
    if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;

    const href = a.getAttribute('href');
    if (!href || href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
    if (a.target && a.target !== '_self') return;

    // Only same-origin navigations
    let url;
    try {
      url = new URL(href, window.location.href);
    } catch {
      return;
    }
    if (url.origin !== window.location.origin) return;

    // If it's the same page with just a hash, don't animate
    const sameDoc = (url.pathname === window.location.pathname) && (url.search === window.location.search);
    if (sameDoc && url.hash) return;

    e.preventDefault();
    document.body.classList.add('is-exiting');

    // Small delay for fade-out
    window.setTimeout(function() {
      window.location.href = url.href;
    }, 260);
  }, true);
})();
</script>

<script>
// Hamburger Menu Toggle
(function() {
  const hamburger = document.querySelector('.hamburger');
  const navLinks = document.querySelector('.nav-links'); const header = document.querySelector('.sticky-header');
  
  if (hamburger && navLinks) {
    hamburger.addEventListener('click', function() {
      hamburger.classList.toggle('active');
      navLinks.classList.toggle('active'); if (header) header.classList.toggle('menu-open');
    });
    
    // Close menu when clicking a link
    document.querySelectorAll('.header-nav-link').forEach(function(link) {
      link.addEventListener('click', function() {
        hamburger.classList.remove('active');
        navLinks.classList.remove('active'); if (header) header.classList.remove('menu-open');
      });
    });
  }
})();
</script>

</body>
</html>
